# Queens 퍼즐 게임 디자인

## 개요

LinkedIn Games에서 인기를 끌고 있는 Queens 퍼즐 게임을 canvas-mobile 라우트 그룹으로 구현한다. 지뢰찾기와 유사한 X 마킹/힌트 시스템을 추가하여 논리적 추론과 점진적 풀이를 강조한다.

## GAME_META

```typescript
export const GAME_META: TGameMeta = {
  id: 'queens',
  title: 'Queens',
  engine: 'canvas',
  platform: 'both',
  touchControls: 'tap',
  orientation: 'portrait',
  category: 'puzzle',
  difficulty: 'selectable',
};
```

## 게임 규칙

### 기본 규칙
- NxN 그리드에 N개의 색상 영역이 존재
- 각 색상 영역에 정확히 퀸 1개 배치
- 각 행에 퀸 1개, 각 열에 퀸 1개
- 퀸끼리 대각선 포함 인접 불가 (8방향)

### 조작 (2단계 시스템)
- **1번 탭/클릭**: X 마킹 (이 칸에 퀸 불가능 표시)
- **2번 탭/클릭**: 퀸 배치
- **3번 탭/클릭**: 초기화 (빈 칸으로 복원)
- 키보드: 방향키 이동 + Space(순환 토글)

### 난이도

| 레벨 | 그리드 | 색상 영역 | 기준시간 | 시간 보너스 배율 |
|------|--------|----------|---------|----------------|
| Easy | 5x5 | 5개 | 120초 | x1 |
| Normal | 7x7 | 7개 | 300초 | x2 |
| Hard | 9x9 | 9개 | 600초 | x3 |

### 점수 시스템
- 기본 점수 = `난이도배율 × max(0, 기준시간 - 클리어시간(초))`
- 힌트 사용 시: 클리어시간에 30초 패널티 추가
- 잘못된 퀸 배치 시: 빨간색 피드백 표시 후 0.5초 뒤 자동 제거, 시간은 계속 흐름

### 힌트 시스템
- 난이도별 힌트 횟수: Easy 3회, Normal 2회, Hard 1회
- 힌트 사용 시 랜덤 빈 칸 하나에 올바른 값(퀸 또는 X) 표시
- 사용할 때마다 30초 시간 패널티

## 퍼즐 생성 알고리즘

1. **퀸 배치 생성**: N-Queens 변형 (인접 불가 조건 포함) 으로 유효한 배치 랜덤 생성
2. **색상 영역 생성**: 각 퀸 위치를 시드로 Flood-fill 확장하여 N개 영역 생성
3. **유일해 검증**: 백트래킹으로 해가 유일한지 확인
4. **재생성**: 유일하지 않으면 영역 재생성 또는 새 배치 시도

## UI/UX

### 화면 구성 (세로)

```
┌──────────────────────────┐
│  Easy | Normal | Hard    │  난이도 선택 탭
├──────────────────────────┤
│  ⏱ 00:42    💡 Hint(2)  │  타이머 + 힌트
├──────────────────────────┤
│                          │
│    ┌──┬──┬──┬──┬──┐     │
│    │  │  │  │  │  │     │  NxN 그리드
│    ├──┼──┼──┼──┼──┤     │  색상 영역 배경
│    │  │  │  │  │  │     │
│    ├──┼──┼──┼──┼──┤     │
│    │  │  │  │  │  │     │
│    ├──┼──┼──┼──┼──┤     │
│    │  │  │  │  │  │     │
│    ├──┼──┼──┼──┼──┤     │
│    │  │  │  │  │  │     │
│    └──┴──┴──┴──┴──┘     │
│                          │
└──────────────────────────┘
```

### 시각적 피드백
- **X 마킹**: 셀 위에 가는 X 표시 (회색)
- **퀸 배치**: 왕관 아이콘 또는 원형 마커
- **오류**: 충돌하는 퀸 쌍을 빨간색으로 강조, 0.5초 후 자동 제거
- **클리어**: 전체 보드 축하 애니메이션 (셀 순차 밝아짐)
- **영역 색상**: 파스텔 톤 팔레트 (아케이드 테마와 조화)

### 컨트롤

**모바일 (터치):**
- 셀 탭: X → 퀸 → 빈칸 순환
- 힌트 버튼 탭: 힌트 사용
- 난이도 탭 탭: 난이도 변경 + 새 퍼즐

**데스크탑 (키보드):**
- 방향키: 셀 커서 이동
- Space: X → 퀸 → 빈칸 순환
- H: 힌트 사용
- S: 시작, P: 일시정지, R: 재시작, M: 음소거

## 아키텍처

### 디렉토리 구조
```
app/(canvas-mobile)/queens/
├── _lib/
│   ├── config.ts      # GAME_META + 상수 (색상 팔레트, 난이도 설정)
│   ├── types.ts       # TCell, TBoard, TDifficulty 등
│   ├── generator.ts   # 퍼즐 생성 알고리즘
│   └── game.ts        # 게임 로직 + 키보드/터치 이벤트
├── _components/
│   └── queens.tsx     # 게임 컴포넌트 (CSS transform 스케일링)
├── layout.tsx
└── page.tsx           # 모바일: Sheet 메뉴, 데스크탑: 3칼럼
```

### 캔버스 크기
- CANVAS_SIZE = 620 (기존 canvas-mobile 게임과 동일)
- CSS transform으로 모바일 자동 스케일링

### 등록 필수 파일 (6개)
1. `@types/scores.ts` — TGameType에 'queens' 추가
2. `lib/config.ts` — MENU_LIST에 Queens 메뉴 추가
3. `components/common/GameCard.tsx` — 게임 아이콘 추가
4. `app/api/game-session/route.ts` — VALID_GAME_TYPES에 추가
5. `app/api/scores/route.ts` — VALID_GAME_TYPES에 추가
6. `lib/game-security/config.ts` — 보안 설정 추가
